{% extends 'factus/base.html' %}
{% block title %}Crear Factura{% endblock %}
{% block content %}

<div class="container">
    <form id="generarFactura">
        <!-- Datos Generales -->
        <h3 class="text-center">Datos Generales de la Factura</h3>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="numbering_range_id" class="form-label">Rango de Numeración:</label>
                <select class="form-select" id="numbering_range_id" name="numbering_range_id">
                    <option value="" selected disabled>Seleccione un rango</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="reference_code" class="form-label">Código de Referencia:</label>
                <input type="text" class="form-control" id="reference_code" name="reference_code"
                    placeholder="Código único de la factura">
            </div>
        </div>
        <div class="mb-3">
            <label for="observation" class="form-label">Observaciones:</label>
            <textarea class="form-control" id="observation" name="observation" rows="3"
                placeholder="Máximo 250 caracteres"></textarea>
        </div>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="payment_form" class="form-label">Forma de Pago:</label>
                <select class="form-select" id="payment_form" name="payment_form">
                    <option value="1">Pago de Contado</option>
                    <option value="2">Pago a Crédito</option>
                </select>
            </div>
            <div class="col-md-6 hidden" id="payment_due_date_group">
                <label for="payment_due_date" class="form-label">Fecha de Vencimiento (Crédito):</label>
                <input type="date" class="form-control" id="payment_due_date" name="payment_due_date">
            </div>
        </div>
        <div class="mb-3">
            <label for="payment_method_code" class="form-label">Método de Pago:</label>
            <select class="form-select" id="payment_method_code" name="payment_method_code">
                <option value="" selected disabled>Seleccione un método de pago</option>
            </select>
        </div>

        <!-- Datos del Cliente -->
        <h3 class="text-center">Datos del Cliente</h3>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="organization_type_id" class="form-label">Tipo de Organización:</label>
                <select class="form-select" id="organization_type_id" name="organization_type_id">
                    <option value="1">Persona Jurídica</option>
                    <option value="2">Persona Natural</option>
                </select>
            </div>
        </div>
        <!-- Campos para Persona Jurídica -->
        <div class="row mb-3 juridica">
            <div class="col-md-6">
                <label for="customer_company" class="form-label">Razón Social (Persona Jurídica):</label>
                <input type="text" class="form-control" id="customer_company" name="customer_company"
                    placeholder="Razón social">
            </div>
            <div class="col-md-6">
                <label for="customer_trade_name" class="form-label">Nombre Comercial (Opcional):</label>
                <input type="text" class="form-control" id="customer_trade_name" name="customer_trade_name"
                    placeholder="Nombre comercial">
            </div>
        </div>
        <!-- Campos para Persona Natural -->
        <div class="row mb-3 natural">
            <div class="col-md-6">
                <label for="customer_names" class="form-label">Nombre del Cliente (Persona Natural):</label>
                <input type="text" class="form-control" id="customer_names" name="customer_names"
                    placeholder="Nombre del cliente">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="customer_identification_document_id" class="form-label">Tipo de Identificación:</label>
                <select class="form-select" id="customer_identification_document_id"
                    name="customer_identification_document_id">
                    <option value="" selected disabled>Seleccione un tipo de documento</option>
                </select>
            </div>
            <div class="col-md-6">
                <label for="customer_identification" class="form-label">Número de Identificación:</label>
                <input type="text" class="form-control" id="customer_identification" name="customer_identification"
                    placeholder="Número de identificación">
            </div>
        </div>
        <div class="row mb-3 hidden" id="customer_dv_group">
            <div class="col-md-6">
                <label for="customer_dv" class="form-label">Dígito de Verificación (DV):</label>
                <input type="number" class="form-control" id="customer_dv" name="customer_dv"
                    placeholder="Dígito de verificación">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="customer_address" class="form-label">Dirección:</label>
                <input type="text" class="form-control" id="customer_address" name="customer_address"
                    placeholder="Dirección del cliente">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="customer_email" class="form-label">Correo Electrónico:</label>
                <input type="email" class="form-control" id="customer_email" name="customer_email"
                    placeholder="Correo electrónico">
            </div>
            <div class="col-md-6">
                <label for="customer_phone" class="form-label">Teléfono:</label>
                <input type="text" class="form-control" id="customer_phone" name="customer_phone"
                    placeholder="Teléfono del cliente">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="municipality_select" class="form-label">Municipio:</label>
                <select class="form-select" id="municipality_select" name="municipality_id">
                    <option value="" selected disabled>Seleccione un municipio</option>
                </select>
            </div>
        </div>

        <!-- Datos de los Productos -->
        <h3 class="text-center">Productos o Servicios</h3>
        <!-- Bloque para ingresar producto -->
        <div id="productEntry">
            <div class="row mb-3">
                <div class="col-md-3">
                    <input type="text" class="form-control" id="prod_name" placeholder="Producto/Servicio">
                </div>
                <div class="col-md-2">
                    <input type="number" class="form-control" id="prod_quantity" placeholder="Cantidad">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="prod_unit">
                        <option value="" selected disabled>Unidad</option>
                        <!-- Se llenan dinámicamente -->
                    </select>
                </div>
                <div class="col-md-2">
                    <input type="number" step="0.01" class="form-control" id="prod_price" placeholder="Precio">
                </div>
                <div class="col-md-2">
                    <select class="form-select" id="tributos_select">
                        <option value="" selected disabled>Tributo</option>
                        <!-- Se llenan dinámicamente -->
                    </select>
                </div>
                <div class="col-md-1">
                    <button type="button" id="addProductBtn" class="btn-neon"><i
                            class="bi bi-plus-square-dotted"></i></button>
                </div>
            </div>
            <div class="row mb-3">
                <div class="col-md-6">
                    <input type="number" step="0.01" class="form-control" id="prod_discount"
                        placeholder="Descuento (%)">
                </div>
                <div class="col-md-6">
                    <input type="text" class="form-control" id="prod_tax" placeholder="Impuesto (%)" readonly>
                </div>
            </div>
        </div>

        <!-- Tabla para listar productos agregados -->
        <table id="productsTable">
            <thead>
                <tr>
                    <th>Producto/Servicio</th>
                    <th>Cantidad</th>
                    <th>Unidad</th>
                    <th>Precio</th>
                    <th>Tributo</th>
                    <th>Descuento (%)</th>
                    <th>Impuesto (%)</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>

        <br>

        <!-- Botón de Envío -->
        <div class="d-grid">
            <button type="submit" class="btn-neon">Generar Factura</button>
        </div>
    </form>
</div>

{% include 'factus/modal_cargar.html' %}

<script>

const urlMetodosPago = "{{ url_for('utils.get_metodos_pago') }}";
const urlTiposDocumento = "{{ url_for('utils.get_tipos_documento') }}";
const urlUnidadesMedida = "{{ url_for('utils.get_unidades_de_medida') }}";
const urlTributos = "{{ url_for('utils.get_tributos') }}";
const urlRangosNumeracion = "{{ url_for('utils.get_rangos_numeracion') }}";
const urlMunicipios = "{{ url_for('utils.get_municipios') }}";
const urlGenerarFactura = "{{ url_for('factura.generar_factura') }}";
const urlLocation = "{{ url_for('factus.index') }}";

</script>
<script src="{{ url_for('static', filename='js/crear_factura.js') }}"></script>
{% endblock %}